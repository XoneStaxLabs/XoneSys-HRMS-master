@{
    ViewBag.Title = "Index";
}

<script src="~/plugins/Toast/src/jquery.toast.js"></script>
<link href="~/plugins/Toast/src/jquery.toast.css" rel="stylesheet" />

<script type="text/javascript">
    $(document).ready(function () {

        $('input[type=checkbox]').click(function () {       
            // children checkboxes depend on current checkbox
            $(this).next().find('input[type=checkbox]').prop('checked', this.checked);
            // go up the hierarchy - and check/uncheck depending on number of children checked/unchecked
            $(this).parents('ul').prev('input[type=checkbox]').prop('checked', function () {
                return $(this).next().find(':checked').length;
            });
        });

        $("#BtnSetOFF").click(function () {
                       
            $("#SetEmpOffdays").validate({
                rules: {

                }
            });

            if ($("#SetEmpOffdays").valid())
            {
                var Emps = [];
                $('input[name="CandName"]:checked').each(function () {
                    Emps.push($(this).val());
                });

                $.ajax({
                    type: "POST",
                    url: "/SetOffDays/SaveEmpOff",
                    data: {
                        EmpID: JSON.stringify(Emps),
                        OFFDate: $("#OFFDate").val()
                    },

                }).done(function (data) {
                    
                    $.toast({
                        text: data.Message,
                        position: 'top-right',
                        hideAfter: 3000,
                        showHideTransition: 'slide',
                        loader: false,
                    })
                    $('input[type=checkbox]').prop("checked", false);
                    $("#OFFDate").val("");
                });
               
            }

        });

        $('#OFFDate').change(function () {
            $(this).blur();
        })

    });
</script>

<style>
    ul {
        list-style-type: none;
    }
</style>

<section class="content-header">
    <h1>
        Set Off Days To Employee
    </h1>    
</section>
<section class="newforms">

    <form class="" action="#" id="SetEmpOffdays">
        <div class="form-group">
            <div class="form-group">
                <label for="inputEmail3" class="col-sm-2 control-label">Select OFF Day</label>
                <div class="col-sm-10">
                    <div class="col-sm-4">
                        <input type="text" class="form-control daterangepicker-single required" id="OFFDate" name="OFFDate" placeholder="OFF Date">    
                    </div>                                   
                </div>
            </div>  <hr />
            <div class="form-group">
                <ul class="tree">
                    <li>
                        <input type="checkbox" name="Employees"/>
                        <label>Select Employees</label>
                        <ul>
                            @if (ViewBag.employee != null)
                            {
                                foreach (var item in ViewBag.employee)
                                {
                                     <li><input type="checkbox" name="CandName" value="@item.EmpID" data-EmpID="@item.EmpID"/>@item.CandName</li>
                                }  
                            }                                                      
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-sm btn-success" id="BtnSetOFF">Save<span>&nbsp;</span> <i class="fa fa-floppy-o"></i></button>
        </div>
    </form>

</section>
